#!/bin/bash

# 💠 Setup: Create and enter runner folder
RUNNER_DIR="actions-runner"
mkdir -p "$RUNNER_DIR" && cd "$RUNNER_DIR"

# 📦 Download latest runner package
RUNNER_VERSION="2.326.0"
PACKAGE_NAME="actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz"
curl -o "$PACKAGE_NAME" -L "https://github.com/actions/runner/releases/download/v${RUNNER_VERSION}/${PACKAGE_NAME}"

# 🔐 Optional: Validate SHA256 hash (auditable)
echo "9c74af9b4352bbc99aecc7353b47bcdfcd1b2a0f6d15af54a99f54a0c14a1de8  $PACKAGE_NAME" | shasum -a 256 -c

# 📂 Extract the package
tar -xzf "$PACKAGE_NAME"

# ⚙️ Configure runner with repo & token
REPO_URL="https://github.com/alexandros-thomson/git-credential-manager"
REG_TOKEN="BO2SD54TU5FGDYKEBONRSFLIQ237K" # Rotate if expired
./config.sh --url "$REPO_URL" --token "$REG_TOKEN"

# 🧱 Log runner identity for sponsor ledger (optional)
echo "Runner configured for: $REPO_URL on $(hostname) at $(date)" >> runner.log
